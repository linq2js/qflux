{"version":3,"sources":["../index.js"],"names":["arguments","hoc","createHoc","length","renderProvider","Context","React","createContext","defaultMapper","state","actions","ownedProps","mapStateToProps","component","props","createElement","Consumer","context","mappedProps","CustomizedConsumer","__component","createStore","initialState","handler","onChange","wiredActions","current","get","wired","Object","entries","forEach","name","action","result","apply","nextState","then","set","changed","key","PureComponent","CustomizedProvider","unmount","forceUpdate","children","prevProps","store","undefined","handleChange","Provider","value"],"mappings":"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","file":"index.js","sourcesContent":["import React from \"react\";\r\n\r\nconst Context = React.createContext();\r\nconst defaultMapper = (state, actions, ownedProps) => ownedProps;\r\n\r\nfunction createHoc(mapStateToProps = defaultMapper) {\r\n  return function(component) {\r\n    return function(props) {\r\n      return React.createElement(Context.Consumer, {}, function(context) {\r\n        const mappedProps = mapStateToProps(\r\n          context.state,\r\n          context.actions,\r\n          props\r\n        );\r\n\r\n        return React.createElement(CustomizedConsumer, {\r\n          __component: component,\r\n          ...mappedProps\r\n        });\r\n      });\r\n    };\r\n  };\r\n}\r\n\r\nfunction createStore(initialState = {}, actions = {}, handler = {}, onChange) {\r\n  const wiredActions = {};\r\n  let current = {\r\n    state: initialState,\r\n    actions: wiredActions\r\n  };\r\n\r\n  handler.get = () => current.state;\r\n  handler.wired = true;\r\n\r\n  // wire all actions\r\n  Object.entries(actions).forEach(([name, action]) => {\r\n    wiredActions[name] = handler[name] = function() {\r\n      let result = action.apply(null, arguments);\r\n      if (typeof result === \"function\") {\r\n        const nextState = result(current.state, current.actions);\r\n        if (nextState && typeof nextState.then === \"function\") {\r\n          nextState.then(set);\r\n        } else {\r\n          set(nextState);\r\n        }\r\n\r\n        return nextState;\r\n      }\r\n    };\r\n  });\r\n\r\n  function set(nextState) {\r\n    if (nextState !== current.state) {\r\n      let changed = false;\r\n      // perform shallow compare to detect change between current state and next state\r\n      for (let key in nextState) {\r\n        if (nextState[key] !== current.state[key]) {\r\n          changed = true;\r\n          if (current.state === nextState) {\r\n            current = {\r\n              state: nextState,\r\n              actions: wiredActions\r\n            };\r\n          }\r\n          current.state[key] = nextState[key];\r\n        }\r\n      }\r\n      // notify change\r\n      if (changed) {\r\n        onChange(current.state);\r\n      }\r\n    }\r\n    return nextState;\r\n  }\r\n\r\n  return {\r\n    current() {\r\n      return current;\r\n    }\r\n  };\r\n}\r\n\r\nclass CustomizedConsumer extends React.PureComponent {\r\n  render() {\r\n    const { __component, ...props } = this.props;\r\n    return React.createElement(__component, props);\r\n  }\r\n}\r\n\r\nclass CustomizedProvider extends React.PureComponent {\r\n  handleChange() {\r\n    !this.unmount && this.forceUpdate();\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.unmount = true;\r\n  }\r\n\r\n  render() {\r\n    const { state, actions, handler, children } = this.props;\r\n    if (this.prevProps !== this.props) {\r\n      this.store = undefined;\r\n    }\r\n\r\n    if (!this.store) {\r\n      this.store = createStore(\r\n        state,\r\n        actions,\r\n        handler,\r\n        () => this.handleChange\r\n      );\r\n    }\r\n\r\n    return React.createElement(Context.Provider, {\r\n      value: this.store.current(),\r\n      children\r\n    });\r\n  }\r\n}\r\n\r\nfunction renderProvider(props) {\r\n  return React.createElement(CustomizedProvider, props);\r\n}\r\n\r\nexport default function() {\r\n  // map state to props\r\n  if (typeof arguments[0] === \"function\") {\r\n    const hoc = createHoc(arguments[0]);\r\n    if (arguments.length > 1) {\r\n      return hoc(arguments[1]);\r\n    }\r\n    return hoc;\r\n  }\r\n  return renderProvider(arguments[0]);\r\n}\r\n"]}